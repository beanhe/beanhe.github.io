---
layout: post
title: CPU使用率详解
category: linux
tags: [__beanhe,kernel,linux,cpu]
---

多数服务器故障都伴随着较高的CPU使用率，在`*nix`系统中，有很多工具可以查看CPU使用状况，不过最直接的方法可以通过查看`/proc/stat`文件里的内容进行分析，如下所示：
```
root@dev-zilyfgt1od7cv:~# cat /proc/stat
cpu  40966 1289 23684 36602471 2349 0 3905 0 0 0
cpu0 26802 76 12704 18272863 946 0 3483 0 0 0
cpu1 14164 1213 10979 18329608 1402 0 422 0 0 0
intr 8395952 37 10 0 0 486 0 3 0 1 0 1274545 0 144 0 53592 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ctxt 12832476
btime 1488164531
processes 16418
procs_running 1
procs_blocked 0
softirq 3978458 1 1260722 437100 743711 53682 0 49 1050459 3338 429396
```
- The very first  "cpu" line aggregates the  numbers in all  of the other "cpuN" lines.  These numbers identify the amount of time the CPU has spent performing different kinds of work.  Time units are in USER_HZ (typically hundredths of a second).  The meanings of the columns are as follows, from left to right:
 - user: normal processes executing in user mode
 - nice: niced processes executing in user mode
 - system: processes executing in kernel mode
 - idle: twiddling thumbs
 - iowait: In a word, iowait stands for waiting for I/O to complete. But there are several problems:
   1. Cpu will not wait for I/O to complete, iowait is the time that a task is waiting for I/O to complete. When cpu goes into idle state for outstanding task io, another task will be scheduled on this CPU.
   2. In a multi-core CPU, the task waiting for I/O to complete is not running on any CPU, so the iowait of each CPU is difficult to calculate.
   3. The value of iowait field in /proc/stat will decrease in certain conditions.
   So, the iowait is not reliable by reading from /proc/stat.
 - irq: Time servicing interrupts
 - softirq: Time servicing softirqs
 - steal:  If you are a VM, time other VMs “stole” from your CPUs
 - guest: running a normal guest.If you are running VMs, the CPU they use
 - guest_nice: running a niced guest
 
- The "intr" line gives counts of interrupts  serviced since boot time, for each of the  possible system interrupts.   The first  column  is the  total of  all interrupts serviced  including  unnumbered  architecture specific  interrupts; each  subsequent column is the  total for that particular numbered interrupt. Unnumbered interrupts are not shown, only summed into the total.

- The "ctxt" line gives the total number of context switches across all CPUs.

- The "btime" line gives  the time at which the  system booted, in seconds since the Unix epoch.

- The "processes" line gives the number  of processes and threads created, which includes (but  is not limited  to) those  created by  calls to the  fork() and clone() system calls.

- The "procs_running" line gives the total number of threads that are running or ready to run (i.e., the total number of runnable threads).

- The   "procs_blocked" line gives  the  number of  processes currently blocked, waiting for I/O to complete.

- The "softirq" line gives counts of softirqs serviced since boot time, for each of the possible system softirqs. The first column is the total of all softirqs serviced; each subsequent column is the total for that particular softirq.

参考：[THE /proc FILESYSTEM](https://www.kernel.org/doc/Documentation/filesystems/proc.txt)
---
layout: post
title: 常见web攻击(XSS，sql注射，代码执行，文件包含等)防御脚本
category: 安全 
tags: [xss,sql注入,安全,web安全]
---
- 跨站脚本攻击（Cross-site scripting，通常简称为XSS）发生在客户端，可被用于进行窃取隐私、钓鱼欺骗、偷取密码、传播恶意代码等攻击行为。 恶意的攻击者将对客户端有危害的代码放到服务器上作为一个网页内容， 使得其他网站用户在观看此网页时，这些代码注入到了用户的浏览器中执行，使用户受到攻击。一般而言，利用跨站脚本攻击，攻击者可窃会话COOKIE从而窃取网站用户的隐私，包括密码。XSS攻击使用到的技术主要为HTML和Javascript，也包括VBScript和ActionScript等。XSS攻击对WEB服务器虽无直接危害，但是它借助网站进行传播，使网站的使用用户受到攻击，导致网站用户帐号被窃取，从而对网站也产生了较严重的危害。
- 漏洞危害： 
1. 钓鱼欺骗：最典型的就是利用目标网站的反射型跨站脚本漏洞将目标网站重定向到钓鱼网站，或者注入钓鱼JavaScript以监控目标网站的表单输入，甚至发起基于DHTML更高级的钓鱼攻击方式。
2. 网站挂马：跨站时利用IFrame嵌入隐藏的恶意网站或者将被攻击者定向到恶意网站上，或者弹出恶意网站窗口等方式都可以进行挂马攻击。
3. 身份盗用：Cookie是用户对于特定网站的身份验证标志，XSS可以盗取到用户的Cookie，从而利用该Cookie盗取用户对该网站的操作权限。如果一个网站管理员用户Cookie被窃取，将会对网站引发巨大的危害。
4. 盗取网站用户信息：当能够窃取到用户Cookie从而获取到用户身份使，攻击者可以获取到用户对网站的操作权限，从而查看用户隐私信息。
5. 垃圾信息发送：比如在SNS社区中，利用XSS漏洞借用被攻击者的身份发送大量的垃圾信息给特定的目标群。
6. 劫持用户Web行为：一些高级的XSS攻击甚至可以劫持用户的Web行为，监视用户的浏览历史，发送与接收的数据等等。
7. XSS蠕虫：XSS 蠕虫可以用来打广告、刷流量、挂马、恶作剧、破坏网上数据、实施DDoS攻击等。

- 避免XSS的方法之一主要是将用户所提供的内容输入输出进行过滤 ,可以利用下面这些函数对出现xss漏洞的参数进行过滤

```
PHP的htmlentities()或是htmlspecialchars()。
Python的cgi.escape()。
ASP的Server.HTMLEncode()。
ASP.NET的Server.HtmlEncode()或功能更强的Microsoft Anti-Cross Site Scripting Library
Java的xssprotect(Open Source Library)。
Node.js的node-validator。
```

- 使用方法： 
	- 将waf.php传到要包含的文件的目录
	- 在页面中加入防护，有两种做法，根据情况二选一即可：

		- 在所需要防护的页面加入代码就可以做到页面防注入、跨站`require_once('waf.php');`。如果想整站防注，就在网站的一个公用文件中，如数据库链接文件config.inc.php，来调用本代码。常用php系统添加文件
 
		```
		PHPCMS V9 \phpcms\base.php 
		PHPWIND8.7 \data\sql_config.php 
		DEDECMS5.7 \data\common.inc.php 
		DiscuzX2   \config\config_global.php 
		Wordpress   \wp-config.php 
		Metinfo   \include\head.php
		``` 
 
		- 在每个文件最前加上代码具体做法是：在php.ini中找到 auto_prepent_file并修改为: 

		```
		#Automatically add files before or after any PHP document;
		auto_prepend_file = waf.php路径;
		``` 

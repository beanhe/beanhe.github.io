---
layout: post
title: git相关操作
category: git
tags: [git,版本控制]
---
> git add -> 追踪文件:mark file as tracked

- 首先工作区是干净的(clean)

```
[04:59:02 PM]root@devops: ~/opstest.137 master # git status
# On branch master
nothing to commit (working directory clean)
```

- 新建一个文件file，则通过status发现有未被追踪的文件存在(untracked files present)，并提示用git add来追踪

```
[04:59:05 PM]root@devops: ~/opstest.137 master # touch file
[04:59:11 PM]root@devops: ~/opstest.137 master # git status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#	file
nothing added to commit but untracked files present (use "git add" to track)
```

- 使用git add加上文件名即可追踪特定文件，如果有多个文件要追踪可以以空格为分隔接在add后面，若想要追踪所有变化(包括新建，修改，若删除也要追踪则使用git add -A .)，使用git add 后使用status就可以看到提示有新文件file存在但已经没有未追踪的提示了

```
[04:59:12 PM]root@devops: ~/opstest.137 master # git add file
[04:59:17 PM]root@devops: ~/opstest.137 master # git status
# On branch master
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#	new file:   file
#
```

- 若要取消对已经add过的文件的追踪，只需要git reset file即可，若文件是未追踪的，则只要它确实是多余的则可以直接删除，若文件已经被`git add`过，则需要使用`git rm file`命令来删除

```
[05:09:42 PM]root@devops: ~/opstest.137 master # git reset file
[05:09:47 PM]root@devops: ~/opstest.137 master # git status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
#
#	file
nothing added to commit but untracked files present (use "git add" to track)
```

> git commit -> 将git add过的修改提交到本地的当前分支

```
[05:10:50 PM]root@devops: ~/opstest.137 master # git commit -m 'test'
[master 5e6f96b] test
 0 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 file
[05:11:04 PM]root@devops: ~/opstest.137 master # git status
# On branch master
nothing to commit (working directory clean)
```

- 若要取消本次提交可以使用git reset HEAD^恢复

```
[05:10:50 PM]root@devops: ~/opstest.137 master # git commit -m 'test'
[master 5e6f96b] test
 0 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 file
[05:11:04 PM]root@devops: ~/opstest.137 master # git status
# On branch master
nothing to commit (working directory clean)
```

- 上面的命令中HEAD^代表上一次提交的状态,若要恢复到还要前面的分支，只需使用git reset HEAD跟上对应数目的~即可，比如git reset HEAD~等价于git reset HEAD^和git reset HEAD~1，若要恢复到指定提交，可以先通过git log查看提交记录，然后根据提交的相关提示信息和时间判断提交的时间点，然后使用git reset加上对应提交点HASH编号即可,比如下例中，如果想要恢复到提交信息为test10的点，则直接按如下方法：

```
[05:22:22 PM]root@devops: ~/opstest.137 master # git log --pretty=oneline -n 10
05203827bb6fb674921a74fc9929ce482e99f117 ccccc
9fe8e5a91583f53411ef84eba6129e0f0285517e cccc
d2d84649124213a4770a735e13f37c6528f28960 bbb
b652c77abfeb98361f739c27b2416d2a64902b50 aaa
840d23674ea1c50997d830c822fd3ba90a7f02a4 test
c0632ae8e82f05f1861a120f6ca6098603bb239a test10
ffb565386cb89926618478aab8f48ebbce649e4e test999
5cbea92b1b1e77a1a34d3faadd0ed317d406a59b test888
8e5cf2df8361a8078107563735b6a32713cde746 test77
0694d2eb41e09c4bf2e90b4d77b2ecf990637dc6 test6666
[05:24:29 PM]root@devops: ~/opstest.137 master # git reset c0632ae8e82f05f1861a120f6ca6098603bb239a
Unstaged changes after reset:
M	test
[05:24:48 PM]root@devops: ~/opstest.137 master # git log --pretty=oneline -n 10
c0632ae8e82f05f1861a120f6ca6098603bb239a test10
ffb565386cb89926618478aab8f48ebbce649e4e test999
5cbea92b1b1e77a1a34d3faadd0ed317d406a59b test888
8e5cf2df8361a8078107563735b6a32713cde746 test77
0694d2eb41e09c4bf2e90b4d77b2ecf990637dc6 test6666
82bb82feec2a1e91749f61b4e1c2a6197dc44663 test555
34b8979c2d0c540b2fd408dbce1943d394720e94 Merge branch 'master' of git.siyinjia.com:binbin/opstest
35c989aff39bb0220de3aed6c16372206fd759d7 test
d8c31dcb8db139e16f2859f3f5a3b1e1120713df test333
168ce1997316e3486582aa911063161fd5533284 add new
```

- 如果发现git reset操作有误，也是可以恢复的，可先通过git reflog查看git操作历史，然后同样也使用git reset加上历史操作(git reflog)对应的HASH编码即可，如上例中恢复到reset之前的ccccc版本，直接使用如下方法即可，注意此时不能使用git reset HEAD~，因为HEAD是在当前的版本基础上进行操作的：

```
[05:24:50 PM]root@devops: ~/opstest.137 master # git reflog
c0632ae HEAD@{0}: c0632ae8e82f05f1861a120f6ca6098603bb239a: updating HEAD
0520382 HEAD@{1}: HEAD~1: updating HEAD
07100cf HEAD@{2}: HEAD~: updating HEAD
91b30ad HEAD@{3}: HEAD^: updating HEAD
657a78d HEAD@{4}: HEAD^: updating HEAD
49cdc0b HEAD@{5}: 49cdc0b: updating HEAD
0520382 HEAD@{6}: HEAD~2: updating HEAD
91b30ad HEAD@{7}: HEAD^1: updating HEAD
657a78d HEAD@{8}: HEAD^: updating HEAD
5e6f96b HEAD@{9}: commit: test
657a78d HEAD@{10}: HEAD^: updating HEAD
49cdc0b HEAD@{11}: commit: aaa
657a78d HEAD@{12}: pull --rebase origin rc: modify aaa
91b30ad HEAD@{13}: checkout: moving from master to 91b30adf8cbd3969e949758273f2effa69858447^0
aa315df HEAD@{14}: commit: modify aaa
07100cf HEAD@{15}: checkout: moving from master to 07100cff30e82d3ccb895c3bd59234c68ce1a738^0
0520382 HEAD@{16}: checkout: moving from master to 05203827bb6fb674921a74fc9929ce482e99f117^0
9fe8e5a HEAD@{17}: checkout: moving from master to 9fe8e5a91583f53411ef84eba6129e0f0285517e^0
d2d8464 HEAD@{18}: checkout: moving from master to d2d84649124213a4770a735e13f37c6528f28960^0
b652c77 HEAD@{19}: checkout: moving from master to b652c77abfeb98361f739c27b2416d2a64902b50^0
840d236 HEAD@{20}: pull origin master: Fast-forward
c0632ae HEAD@{21}: pull origin master: Fast-forward
ffb5653 HEAD@{22}: pull origin master: Fast-forward
5cbea92 HEAD@{23}: pull origin master: Fast-forward
8e5cf2d HEAD@{24}: pull origin master: Fast-forward
0694d2e HEAD@{25}: pull origin master: Fast-forward
82bb82f HEAD@{26}: pull origin master: Fast-forward
34b8979 HEAD@{27}: initial pull
[05:28:07 PM]root@devops: ~/opstest.137 master # git reset 0520382
Unstaged changes after reset:
M	aaa
[05:28:15 PM]root@devops: ~/opstest.137 master # git log --pretty=oneline -n 6
05203827bb6fb674921a74fc9929ce482e99f117 ccccc
9fe8e5a91583f53411ef84eba6129e0f0285517e cccc
d2d84649124213a4770a735e13f37c6528f28960 bbb
b652c77abfeb98361f739c27b2416d2a64902b50 aaa
840d23674ea1c50997d830c822fd3ba90a7f02a4 test
c0632ae8e82f05f1861a120f6ca6098603bb239a test10

```

---
layout: post
title: MySQL5.7更新至密码策略
category: mysql 
tags: [mysql]
---
#### mysql 5.7密码修改

- mysql 5.7之后增加了安全机制，密码需要符合事先定义好的安全策略，否则无法修改密码，出现类似`ERROR 1819 (HY000): Your password does not satisfy the current policy requirements`的报错，至于密码的安全策略是可选的，当前的策略可以通过`show variables like 'validate_password%'`查看，如下：

		```
		mysql> show variables like 'validate_password%';
		| Variable_name                        | Value |
		| validate_password_dictionary_file    |       |
		| validate_password_length             | 8     |
		| validate_password_mixed_case_count   | 1     |
		| validate_password_number_count       | 1     |
		| validate_password_policy             | LOW   |
		| validate_password_special_char_count | 1     |
		6 rows in set (0.01 sec)
		```

	- 可以看到我的安全策略是`LOW`级别的，还有`MEDIUM`和`STRONG`两种更高级别的策略，具体信息如下：
	
		- LOW 政策只测试密码长度。 密码必须至少有8个字符长。
		- MEDIUM 政策的条件 密码必须包含至少1数字字符,1 大写和小写字符,和1特别 (nonalphanumeric)字符。
		- STRONG 政策的情况 密码子字符串长度为4的或更长时间不能匹配 单词在字典文件中,如果一个人被指定。
		
	- 修改密码安全策略方法：
		- 通过全局变量的方式修改：`SET GLOBAL validate_password_policy = STRONG`，立即生效
		- 修改配置文件，需重启生效：
		
		```
		[mysqld]
		validate_password_policy = STRONG	
		```


- 修改密码的方法：
	- 推荐： 直接使用`mysql_secure_installation`命令通过交互式方式根据提示修改，具体参数使用`mysql_secure_installation --help`命令查看
	- 通过`mysqld --skip-grant-tables`启动mysql或者在`my.cnf`文件的`[mysqld]`中的加入`skip-grant-tables`字段重启然后使用root以空密码登入mysql，再通过命令`ALTER USER 'XXX'@'XXX' IDENTIFIED WITH mysql_native_password AS 'password'` 修改所需用户密码
		
- 默认情况下，密码的有效期为360天，到期需要修改，否则过期后会进入`restricted mode`，出现` ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.`的报错，如果希望密码永不过期（不推荐），有两种方式：
	- 可以通过修改参数`default_password_lifetime`值为`0`的方法实现，
		- 全局变量（立即生效）：`SET GLOBAL default_password_lifetime = 0`
		- 配置文件（重启生效）：
		
			```
			[mysqld]
			default_password_lifetime = 0		
			```

		- 命令修改（立即生效）：`ALTER USER 'XXX'@'XXX' PASSWORD EXPIRE NEVER`
		
- 另：
	- 默认情况下，Mac OS X安装的mysql5.7没有`my.cnf`文件，所有配置均使用程序默认值，需要自定义配置直接新建`/etc/my.cnf`或者`/usr/local/Cellar/mysql/5.7.10/support-files/my.cnf`等文件即可，具体参考[链接](http://forums.mysql.com/read.php?11,366143,376017#msg-376017)
		
- 参考连接：
	- [http://dev.mysql.com/doc/refman/5.7/en/password-expiration-policy.html](http://dev.mysql.com/doc/refman/5.7/en/password-expiration-policy.html)

---
layout: post
title: rsync用法总结
category: rsync
tags: [rsync,同步,inotify]
---

> rsync作为一个同步工具，提供了很多参数来满足日常需求，下面是博主在使用过程中的一些总结：

- `--update`: 只将更新过的文件同步到目标端，更新包括新建文件、修改文件,官方说法是跳过目标端文件mtime比源端新的那些文件，即

```
# rsync -h 中：
 -u, --update                skip files that are newer on the receiver

# rsync的MAN手册中：
-u, --update
       This forces rsync to skip any files which exist on the destination and have a modified time that is newer than the source file.  (If an existing destination file has a  modi-
       fication time equal to the source file’s, it will be updated if the sizes are different.)

       Note  that  this does not affect the copying of symlinks or other special files.  Also, a difference of file format between the sender and receiver is always considered to be
       important enough for an update, no matter what date is on the objects.  In other words, if the source has a directory where the destination has a  file,  the  transfer  would
       occur regardless of the timestamps.

       This  option  is a transfer rule, not an exclude, so it doesn’t affect the data that goes into the file-lists, and thus it doesn’t affect deletions.  It just limits the files
       that the receiver requests to be transferred.
```

- `--delete`: 同步删除操作，即源端被删除的文件也会在目标端被删除
- `--exclude=PATTERN`: 通过正则表达式匹配那些不需要被同步的文件或目录
- `--exclude-file=PATTERN-FILE`: 通过正则表达式文件（一行一个表达式）匹配那些不需要被同步的文件或目录
- `-a`或`--archive`: 以归档的方式进行传输，即递归传输并保持所有的文件属性，相当于-rlptgoD，若不需要这么多选项，比如要排除`-t`选择，则可以在`-a`的时候接上`--no-t`即可，特别是在使用`--update`参数的时候记得`--no-t`，具体分析见`-t`，博主在这里被坑死了，所以如果你对`-a`具体含义不熟悉，还是建议根据需要叠加吧 ^-^
- `-r`或`--recursive`: 以递归的方式进行传输
- `-l`或`--links`: 同步软链接
- `-p`或`--perms`: 保留权限
- `-t`或`--times`: 保留文件的修改时间即mtime，特别注意当使用`--update`参数的时候不要带`-t`参数，因为这样会导致`--update`失效，因为`--update`是根据mtime来判定文件的新旧的，而`-t`会导致每次更新后同时修改目标文件的mtime，也就直接导致目标端的文件永远比源端旧，因为通常我们是先更新源端再同步到目标端
- `-g`或`--group`: 保留文件的属组
- `-o`或`--owner`: 保留文件的属主
- `-D`: 保留设备文件(`--devices`)和特殊文件(`--specilas`)
- `--rsync-path=PROGRAM`: 指定目标端`rsync`命令所在目录
- 在写源目录的时候，末尾是否带有`/`符号是有区别的，比如目标端配置文件`/etc/rsyncd.conf`中定义的目的目录为`/path/of/dest`，若源写为`/path/of/src`则同步结果是会在目的目录下创建一个名为`src`的子目录来存放同步的文件，若原写为`/path/of/src/`则同步结果是直接将`src`里面的文件复制到目的端的`dest`目录下而不会创建`src`的同名子目录
